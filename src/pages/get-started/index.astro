---
import Layout from '../../layouts/Layout.astro';

import { Image } from 'astro:assets';

import Button from '../../components/Button.astro';
import Navigation from '../../components/Navigation.astro';
import Footer from '../../components/Footer.astro';

import whatsAppIcon from '/src/img/whats-app-icon.svg';
import phoneIcon from '/src/img/phone-call.svg';

import "../../styles/main.scss";

import Modal from '../../components/Modal.astro';

import qrImg from '/src/img/qr.png';

import Carousel from '../../components/Carousel.astro';

import card1 from '/src/img/how-works-1.png';
import card2 from '/src/img/how-works-2.png';
import card3 from '/src/img/how-works-3.png';
import card4 from '/src/img/how-works-4.png';

import personalAssistant from '/src/img/personal-assistant.png';
import financeManager from '/src/img/finance-manager.png';
import headOfSales from '/src/img/head-of-sales.png';
import headOfMarketing from '/src/img/head-of-marketing.png';
import csManager from '/src/img/cs-manager.png';

import HubspotModal from '../../components/HubspotModal.astro';

const contentBlocks = [
  {
    image: card1,
    title: 'Give your employees a task and they’ll research and plan it themselves. No more micromanaging.',
    subtitle: 'Learn more about',
    ctaText: 'How they work',
    ctaUrl: '/how-it-works',
  },
  {
    image: card2,
    title: 'Automate your workload by asking. No complicated templates or apps to learn.',
    subtitle: 'Learn more about',
    ctaText: 'AI employees',
    ctaUrl: '/your-ai-pros',
  },
  {
    image: card3,
    title: 'Work at the speed of your voice. Send voice notes or call your employees for any kind of work.',
    subtitle: 'Learn more about',
    ctaText: 'How they work',
    ctaUrl: '/how-it-works',
  },
  {
    image: card4,
    title: 'Your employees have their own email, so they can arrange meetings, coordinate travel and more.',
    subtitle: 'Learn more about',
    ctaText: 'What it costs',
    ctaUrl: '/pricing',
  },
];

---

<Layout title="Dream - Just a call gets you started" noindex>
  <Navigation />
  <header class="hero-home solo-header">
    <div class="hero-elements main-content">
      <section class="header-text content-title">
        <h1 class="page-title">Say hello to your <span class="highlight-title" data-pro-label>Personal Pro</span></h1>
        <p>It takes minutes to get started, choose an option below.</p>
      </section>
    </div>
  </header>

  <main>
    <!-- READY MODULE: shows for ready Pros (personal, sales) -->
    <section class="get-started-content main-content" data-pro-available>
      <article class="content-container">
        <div class="start-cards">
          <div class="card-item">
            <h2>WhatsApp your Pro</h2>
            <p>Chat with your <span data-pro-label>Personal Pro</span> on WhatsApp, and they'll chat about how they can help.</p>

            <Button
              label="Message on WhatsApp"
              href="https://wa.me/447476963324?text=Hi%20I%27m%20interested%20in%20Dream"
              variant="secondary"
              size="medium"
              data-whatsapp
            >
              <img src={whatsAppIcon.src} role="presentation" alt="">
            </Button>
          </div>
          <div class="card-item">
            <h2>Call your Pro</h2>
            <p>Start a voice call with your <span data-pro-label>Personal Pro</span> and they’ll talk you through how they can help.</p>

            <Button
              label="Call your Pro"
              href="tel:+447476963324"
              variant="secondary"
              size="medium"
              data-mobile-call
            >
              <img src={phoneIcon.src} role="presentation" alt="" />
            </Button>

            <Button
              label="Call your Pro"
              variant="secondary"
              size="medium"
              role="button"
              as="button"
              rel="noopener"
              data-open-modal="call-modal"
            >
              <img src={phoneIcon.src} role="presentation" alt="" />
            </Button>
          </div>

        </div>
      </article>
    </section>

    <!-- WAITLIST MODULE: shows for not-ready Pros (marketing, finance, support) -->
    <section class="get-started-content main-content" data-pro-waitlist hidden>
      <article class="content-container">
        <div class="start-cards">
          <div class="card-item starting-soon">
            <h2>We're still onboarding your <span data-pro-label>Marketing Pro</span></h2>
            <p>They're getting the best training. Find out as soon as they're ready to hire.</p>

            <Button
              label="Get notified"
              variant="primary"
              size="medium"
              as="button"
              data-open-modal="mailing-list-modal"
            />
          </div>
        </div>
      </article>
    </section>

    <!-- Active Pro → hide its card in the list below -->
    <script is:inline>
      (function () {
        const params = new URLSearchParams(location.search);
        const key = (params.get('pro') || 'personal').trim().toLowerCase();

        // Single source of truth: label, status, numbers
        const PROS = {
          personal:  { label: 'Personal Pro',  status: 'ready',    phone: '+447476963324', wa: '447476963324' },
          sales:     { label: 'Sales Pro',     status: 'ready',    phone: '+447476963324', wa: '447476963324' },
          marketing: { label: 'Marketing Pro', status: 'waitlist', phone: '+447476963324', wa: '447476963324' },
          finance:   { label: 'Finance Pro',   status: 'waitlist', phone: '+447476963324', wa: '447476963324' },
          support:   { label: 'Support Pro',   status: 'waitlist', phone: '+447476963324', wa: '447476963324' }
        };

        const toTitle = (s) => s.replace(/[-_]+/g,' ').replace(/\b\w/g, m => m.toUpperCase()).trim();
        const toWaDigits = (s) => (s || '').replace(/[^\d]/g, '');

        const base = PROS[key] || { label: `${toTitle(key)} Pro`, status: 'waitlist', phone: '+447476963324', wa: '447476963324' };

        // Expose to CSS
        document.documentElement.setAttribute('data-pro-active', key);
        document.documentElement.setAttribute('data-pro-status', base.status);

        // Update labels
        document.querySelectorAll('[data-pro-label]').forEach(el => el.textContent = base.label);

        // Update tel
        const callBtn = document.querySelector('[data-mobile-call]');
        if (callBtn) callBtn.setAttribute('href', `tel:${base.phone}`);

        // Update WhatsApp
        const waBtn = document.querySelector('[data-whatsapp]');
        if (waBtn) {
          const text = `Hi, I'm interested in Dream (${base.label})`;
          waBtn.setAttribute('href', `https://wa.me/${toWaDigits(base.wa)}?text=${encodeURIComponent(text)}`);
        }

        // Toggle ready vs waitlist modules
        const ready  = document.querySelector('[data-pro-available]');
        const wait   = document.querySelector('[data-pro-waitlist]');
        if (ready && wait) {
          const isReady = base.status === 'ready';
          ready.hidden = !isReady;
          wait.hidden  =  isReady ? true : false;
        }
      })();
    </script>

    <!-- CSS rules to hide the active pro’s card -->
    <style is:global>
      [data-pro-active="personal"]  [data-pro-card="personal"]  { display: none !important; }
      [data-pro-active="sales"]     [data-pro-card="sales"]     { display: none !important; }
      [data-pro-active="marketing"] [data-pro-card="marketing"] { display: none !important; }
      [data-pro-active="finance"]   [data-pro-card="finance"]   { display: none !important; }
      [data-pro-active="support"]   [data-pro-card="support"]   { display: none !important; }

      /* Optional: prevent flash if you want to hard-hide by status too */
      [data-pro-status="ready"]    [data-pro-waitlist] { display: none !important; }
      [data-pro-status="waitlist"] [data-pro-available] { display: none !important; }
    </style>

    <section class="main-content">
      <article class="content-container full-width">
        <div class="content-title">
          <h2>Smart employees, <br/>Meet <span class="highlight-title">powerful tools</span></h2>
          <p>Dream’s AI employees use some of the most advanced technology on the planet, but we made them even better by giving them custom tools so they can work smarter and faster.</p>
        </div>
        <Carousel items={contentBlocks} />
      </article>
    </section>
  </main>

  <Modal id="call-modal" closeLabel="Close">
    <h2 slot="title" id="qrTitle">Get started with Dream in minutes</h2>
    <p>All it takes is a quick call. You'll speak directly to your new team member, no humans involved.</p>
    <section class="qr-modal">
      <figure class="qr-modal__visual">
        <img src={qrImg.src} width="256" height="256" alt="">
      </figure>
    </section>
  </Modal>

  <HubspotModal />

  <Footer />

  <!-- Desktop/touch detection (unchanged) -->
  <script is:inline>
    (function () {
      var mqDesktop = matchMedia('(hover: hover) and (pointer: fine)');
      function set() {
        var uaMobile = (navigator.userAgentData && navigator.userAgentData.mobile === true);
        var hasTouch = (navigator.maxTouchPoints || 0) > 0;
        var desktoplike = mqDesktop.matches && !uaMobile && !hasTouch;
        document.documentElement.classList.toggle('desktoplike', desktoplike);
      }
      set();
      mqDesktop.addEventListener?.('change', set);
    })();
  </script>
</Layout>
