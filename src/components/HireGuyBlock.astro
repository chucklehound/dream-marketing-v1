---
import Button from "./Button.astro";
import Modal from "./Modal.astro";

import qrImg from '/src/img/qr.png';
---

<section class="main-content">
  <article class="full-width-contrast promo-home promo-phone">
    <div class="content-container">
      <div class="content-title">
        <h2>
          Hire your team as easily as <br />
          <span class="highlight-title">saying ‘hello...’</span>
        </h2>
        <p>No complicated sign-up, either call or WhatsApp and hire your Dream team in minutes.</p>

        <div class="actions">
            <Button
            target=""
            variant="secondary"
            size="medium"
            data-open-modal="mailing-list-modal"
            label="">Be the first to hire</Button>
        </div>
      </div>
    </div>
  </article>

  <!-- Static modal (PNG QR + tel fallback) -->
  <Modal id="call-modal" closeLabel="Close">
    <h2 slot="title" id="qrTitle">Get started with Dream in minutes</h2>
    <p>All it takes is a quick call. You'll speak directly to your Personal Assistant, no humans involved.</p>
    <div class="qr-modal">
      <figure class="qr-modal__visual">
        <img src={qrImg.src} width="256" height="256" alt="">
      </figure>
    </div>
  </Modal>
</section>

<style>
/* Scoped visibility swap (match base selector weight) */
.promo-phone .button.secondary.medium[data-mobile-call]{display:inline-flex}
.promo-phone .button.secondary.medium[data-open-modal="call-modal"]{display:none}

/* When desktop-like, swap visibility */
html.desktoplike .promo-phone .button.secondary.medium[data-mobile-call]{display:none}
html.desktoplike .promo-phone .button.secondary.medium[data-open-modal="call-modal"]{display:inline-flex}
</style>

<script is:inline>
  // Tiny, idempotent desktop detection; safe across multiple instances
  (function(){
    if (document.documentElement.classList.contains('desktoplike')) return;
    var mq = matchMedia('(hover: hover) and (pointer: fine)');
    function set(){
      var uaMobile = navigator.userAgentData?.mobile === true;
      var hasTouch = (navigator.maxTouchPoints || 0) > 0;
      var desktoplike = mq.matches && !uaMobile && !hasTouch;
      document.documentElement.classList.toggle('desktoplike', desktoplike);
    }
    set();
    mq.addEventListener?.('change', set);
  })();
</script>
